import{e as v,b as B,r as l,j as e}from"./index-COlOKGVa.js";import{T as C,p as R}from"./Topbar-C2H_McEf.js";import{p as F}from"./Product-BQCOhBn7.js";import{I as L}from"./InquiriesService-D6_IMM9T.js";import{S as Q}from"./SellerBuyerService-CyBNmB6f.js";import{g as M}from"./ProductService-BTIW0j6s.js";import{B as z}from"./Back-DUcgJcu8.js";const V="http://lyncorganikness.ap-south-1.elasticbeanstalk.com/auth/admin/sellerSellingProduct",_=async(t,a,m)=>{const i=localStorage.getItem("authToken");if(!i)throw new Error("No token found, please login");try{const c=await v.get(`${V}/${t}/${a}/${m}`,{headers:{Authorization:`Bearer ${i}`}});if(!c.data)throw new Error("No data returned from the API");return c.data}catch(c){G(c,"Error fetching seller information")}},G=(t,a)=>{throw t.response?(console.error(`${a}:`,t.response.data),new Error(`Error: ${t.response.status} - ${t.response.data.message||t.response.data}`)):t.request?(console.error("No response received:",t.request),new Error("Network error, please check your connection.")):(console.error("Unexpected error:",t.message),new Error(`Unexpected error: ${t.message}`))},H={getSellerInfo:_},J="http://lyncorganikness.ap-south-1.elasticbeanstalk.com/auth/admin",K=async(t,{sellerUIds:a,adminInitialPrice:m,avgLeadTime:i,adminAddressId:c,description:x})=>{if(!t)throw new Error("Query ID is required");const p=localStorage.getItem("authToken");if(!p)throw new Error("No token found, please login");const u=`${J}/sendInquiryToSeller/${t}`,h={sellerUIds:a,adminInitialPrice:m,avgLeadTime:i,adminAddressId:c,description:x};console.log("Sending payload to API:",h),console.log("API endpoint:",u);try{const n=await v.post(u,h,{headers:{Authorization:`Bearer ${p}`,"Content-Type":"application/json"}});return n.status==200?console.log("Inquiry sent successfully. Response:",n.data):console.log(n.status),n.data}catch(n){throw n.response?(console.error("API Error:",n.response.data),new Error(n.response.data.message||"Failed to send inquiry.")):n.request?(console.error("Network Error:",n.request),new Error("Network error, please try again later.")):(console.error("Unexpected Error:",n.message),new Error("Unexpected error occurred."))}},ae=()=>{const{queryId:t}=B(),[a,m]=l.useState(null),[i,c]=l.useState([]),[x,p]=l.useState(""),[u,h]=l.useState("");l.useState(!1);const[n,I]=l.useState(""),[y,k]=l.useState([]),[N,j]=l.useState(!1),[O,w]=l.useState(""),[S,b]=l.useState("");l.useEffect(()=>{(async()=>{try{const o=await L.getInquiryById(t),{productId:d,productFormId:f,productVarietyId:A}=o,U=(await M()).find(g=>g.productId===d);m({...U,...o});const q=await H.getSellerInfo(d,f,A),$=await Q.fetchAllUsers(),T=q.map(g=>{const r=$.find(D=>D.userId===g.sellerId);return{...g,sellerName:(r==null?void 0:r.fullName)||"Unknown",email:(r==null?void 0:r.email)||"Unknown",phoneNumber:(r==null?void 0:r.phoneNumber)||"Unknown",country:(r==null?void 0:r.country)||"Unknown",state:(r==null?void 0:r.state)||"Unknown",city:(r==null?void 0:r.city)||"Unknown",pinCode:(r==null?void 0:r.pinCode)||"Unknown"}});k(T)}catch(o){console.error("Error fetching data:",o.message),alert("Failed to fetch product or seller details. Please try again.")}})()},[t]);const P=s=>{c(o=>o.includes(s)?o.filter(d=>d!==s):[...o,s])},E=async()=>{j(!0),w("");const s=i.map(d=>{var f;return(f=y[d])==null?void 0:f.sellerId});console.log("Seller IDs being sent:",s);const o={sellerUIds:s,adminInitialPrice:parseFloat(x),avgLeadTime:parseFloat(u),description:n,adminAddressId:"1"};try{await K(t,o),w("Inquiry sent successfully!"),c([]),p(""),h(""),I(""),b("Query sent successfully!")}catch(d){console.error("Error sending query:",d)}finally{j(!1)}};return e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx(C,{title:"Send Query",userName:"Admin",showSearchBar:!1}),e.jsxs("div",{className:"container mt-4",children:[e.jsx(z,{}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-5",children:[e.jsx("h6",{children:"Product Information"}),a?e.jsx("div",{className:"card p-3 shadow-sm mb-4",style:{borderRadius:"8px"},children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-3",children:e.jsx("img",{src:F,alt:"Product",style:{width:"82px",height:"80px",borderRadius:"8px",objectFit:"cover"}})}),e.jsxs("div",{className:"col-9 ps-3",children:[e.jsx("p",{style:{margin:"0",fontSize:"18px"},children:a.productName}),e.jsxs("p",{className:"product-description",children:["Variety: ",a.varietyName||"N/A"]}),e.jsxs("p",{className:"product-description",children:["Quantity: ",a.quantity," ",a.unit]}),e.jsxs("p",{className:"product-description",children:["Price Range: ",a.askMinPrice," - ",a.askMaxPrice," ",a.priceUnit]}),e.jsxs("p",{className:"product-description",children:["Location: ",a.city,", ",a.state,", ",a.country]})]})]})}):e.jsx("p",{children:"Loading product details..."})]}),e.jsx("div",{className:"col-md-7",children:e.jsxs("div",{className:"card p-3 shadow-sm mb-4",style:{borderRadius:"8px"},children:[e.jsx("h4",{children:"Sellers"}),y.length>0?y.map((s,o)=>e.jsxs("div",{className:"card p-3 shadow-sm mb-3 seller-card position-relative",children:[e.jsxs("div",{className:"d-flex",children:[e.jsx("div",{className:"col-2",children:e.jsx("img",{src:R,alt:"Seller",className:"seller-image"})}),e.jsx("div",{className:"col-10",style:{marginTop:"10px"},children:e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("div",{children:[e.jsxs("h5",{className:"seller-id",children:["Seller ID: ",s.sellerId]}),e.jsx("p",{className:"seller-name",children:s.sellerName}),e.jsx("p",{className:"seller-email",children:s.email}),e.jsx("p",{className:"seller-phone-number",children:s.phoneNumber}),e.jsxs("p",{className:"seller-location",children:[s.city,", ",s.state,", ",s.country,", ",s.pinCode]})]}),e.jsxs("div",{className:"text-end",style:{marginTop:"10px"},children:[e.jsxs("p",{className:"seller-info",children:["Available Quantity: ",s.availableAmount," ",s.unit]}),e.jsxs("p",{className:"seller-info",children:["Price: ",s.minPrice," - ",s.maxPrice]})]})]})})]}),e.jsxs("div",{className:"form-check position-absolute",style:{top:"10px",right:"10px"},children:[e.jsx("input",{type:"checkbox",className:"form-check-input",id:`seller-${o}`,checked:i.includes(o),onChange:()=>P(o)}),e.jsx("label",{className:"form-check-label",htmlFor:`seller-${o}`,children:"Select"})]})]},o)):e.jsx("p",{children:"No sellers found for this product."}),i.length>0&&e.jsx("div",{className:"custom-card mt-3",children:e.jsxs("div",{className:"row align-items-center",children:[e.jsxs("div",{className:"col-6",children:[e.jsx("input",{type:"text",className:"form-control mb-3",placeholder:"Add Price",value:x,onChange:s=>p(s.target.value)}),e.jsx("input",{type:"text",className:"form-control",placeholder:"Average Lead Time",value:u,onChange:s=>h(s.target.value)})]}),e.jsx("div",{className:"col-6 text-end",children:e.jsx("button",{className:"btn btn-dark w-75",onClick:E,disabled:N,children:N?"Sending...":"Send"})})]})}),S&&e.jsx("div",{className:"alert alert-success mt-3",role:"alert",children:S})]})})]})]})]})};export{ae as default};
