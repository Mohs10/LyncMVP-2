import{e as A,b as z,r as c,j as e}from"./index-COlOKGVa.js";import{f as M}from"./ProductService-BTIW0j6s.js";import{T as q}from"./Topbar-C2H_McEf.js";import{A as H,a as W}from"./AddForm-0vLe73vP.js";import{A as G}from"./AddCategory-B_5R9Pc7.js";import"./AddCategoryService-DgzNEtll.js";const J="http://lyncorganikness.ap-south-1.elasticbeanstalk.com/api/editProduct",K="http://lyncorganikness.ap-south-1.elasticbeanstalk.com/api/uploadProductImage",Q=async(o,s,l)=>{var m,i,a,f;console.log("Updating product with ID:",o),console.log(" product data:",s);const p={productName:s.productName,hsnCode:s.hsnCode,categoryId:Number(s.categoryId),varietyIds:((m=s.varietyIds)==null?void 0:m.map(r=>Number(r.varietyId)))||[],formIds:((i=s.formIds)==null?void 0:i.map(r=>Number(r.formId)))||[],productDescription:s.productDescription||"",certifications:((a=s.certifications)==null?void 0:a.map(r=>({certificationName:r.certificationName,isCertified:r.isCertified})))||[],specifications:((f=s.specifications)==null?void 0:f.map(r=>({specificationName:r.specificationName,specificationValue:r.specificationValue,specificationValueUnits:r.specificationValueUnits})))||[]};console.log("productPayload:",p);const u=localStorage.getItem("authToken");if(!u)throw new Error("No token found. Please login to continue.");try{const r=await A.post(`${J}/${o}`,p,{headers:{Authorization:`Bearer ${u}`,"Content-Type":"application/json"}});return console.log("Product updated successfully:",r.data),console.log("imageFile:",l),l&&l instanceof File&&l.size>0?(console.log("Uploading image..."),console.log("Uploading:",l),await X(o,l)):console.log("Image file is either empty or not provided. Skipping image upload."),r.data}catch(r){return U(r,"Error updating product")}},X=async(o,s)=>{console.log("Uploading image for product with ID:",o);const l=Y();if(!l)throw new Error("No token found. Please login to continue.");const p=new FormData;console.log("In image Uploading:",s),p.append("productImage",s);try{const u=await A.post(`${K}/${o}`,p,{headers:{Authorization:`Bearer ${l}`}});return console.log("Image uploaded successfully:",u.data),u.data}catch(u){return U(u,"Error uploading image")}},Y=()=>{try{const o=localStorage.getItem("authToken");return console.log("Token:",o),o}catch(o){return console.error("Failed to retrieve token:",o),null}},U=(o,s)=>{throw console.error("Error details:",o),o.response?(console.error(`${s}:`,o.response.data),new Error(`Error: ${o.response.status} - ${o.response.data.message||o.response.data}`)):o.request?(console.error("No response received:",o.request),new Error("Network error, please check your connection.")):(console.error("Error:",o.message),new Error(`Error: ${o.message}`))},Z=({certifications:o,customCertifications:s,handleCheckboxChange:l,handleAddCustomCertification:p,anyOther:u,setAnyOther:m})=>e.jsx("div",{className:"col-4",children:e.jsxs("div",{className:"certification border-section",style:{width:"250px"},children:[console.log("certifications js:",o),console.log("customCertifications js:",s),Object.entries(o).map(([i,a])=>e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:i,name:i,checked:a,onChange:f=>l(f,"certifications")}),e.jsx("label",{className:"form-check-label",htmlFor:i,children:i.toUpperCase()})]},i)),s.map((i,a)=>e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:`custom-${a}`,checked:i.isCertified,onChange:()=>l(a,"customCertifications")}),e.jsx("label",{className:"form-check-label",htmlFor:`custom-${a}`,children:i.certificationName})]},a)),e.jsxs("div",{className:"row mb-4",children:[e.jsx("div",{className:"col-8",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"Any Others",value:u,onChange:i=>m(i.target.value)})}),e.jsx("div",{className:"col-4 d-flex align-items-end",children:e.jsx("button",{type:"button",className:"btn btn-dark",onClick:p,children:"Add"})})]})]})}),ee=({customSpecifications:o,newSpecification:s,setNewSpecification:l,handleAddSpecification:p,handleSpecificationChange:u})=>e.jsxs("div",{children:[o.map((m,i)=>e.jsxs("div",{className:"form-group row mb-3",children:[e.jsx("label",{className:"col-4 col-form-label",children:m.specificationName}),e.jsx("div",{className:"col-6",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"Enter value",value:m.specificationValue,onChange:a=>u(i,a.target.value)})})]},i)),e.jsxs("div",{className:"form-group row mb-3",children:[e.jsx("div",{className:"col-4",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"Any Other",value:s,onChange:m=>l(m.target.value)})}),e.jsx("div",{className:"col-2 d-flex align-items-end",children:e.jsx("button",{type:"button",className:"btn btn-dark",onClick:p,children:"Add"})})]})]}),de=()=>{const{productId:o}=z(),[s,l]=c.useState(new FormData),[p,u]=c.useState(),[m,i]=c.useState(),[a,f]=c.useState({productDescription:"",productVariety:"",categoryId:"",productForm:"",varietyIds:[],formIds:[],specifications:[],productImageUrl:"",hsnCode:"",productName:"",certifications:[]}),[r,v]=c.useState();c.useState([]),c.useState("");const[te,D]=c.useState("");c.useState(!1);const[oe,V]=c.useState(!0);c.useEffect(()=>{(async()=>{try{const t=await M(o);if(i(t.productImageUrl),console.log("productData:",t),console.log("productImage js:",m),!t)throw new Error("Product not found.");f(d=>({...d,productName:t.productName||"",hsnCode:t.hsnCode||"",categoryId:t.categoryId||"",productDescription:t.productDescription||"",productImageUrl:t.productImageUrl||"",varietyIds:t.varietyIds.map(String)||[],formIds:t.formIds.map(String)||[],certifications:t.certifications.reduce((h,g)=>(h[g.certificationName.toLowerCase()]=g.isCertified||!1,h),{}),specifications:t.specifications||[]})),v(t.categoryId||0),w(t.varietys||[]),k(t.forms||[]),C(t.specifications||[]),y(t.certifications.map(d=>({certificationName:d.certificationName,isCertified:d.isCertified||!1})))}catch(t){console.error("Error fetching data:",t),D(`Error fetching data: ${t.message||t}`)}finally{V(!1)}})()},[o]);const[I,w]=c.useState([]),[S,k]=c.useState([]);c.useState("");const[j,y]=c.useState([]),[b,P]=c.useState(""),[E,C]=c.useState([]),[N,$]=c.useState(""),[se,T]=c.useState([]),F=n=>{const t=n.target.files[0];t&&(l(t),u(URL.createObjectURL(t)))},L=(n,t,d)=>{const{checked:h}=n.target;console.log("Checkbox changed:"),console.log("Certification Name:",d),console.log("Checked:",h),console.log("Type:",t),t==="certifications"?T(g=>g.map(x=>x.certificationName===d?{...x,isCertified:h}:x)):t==="customCertifications"&&y(g=>g.map(x=>x.certificationName===d?{...x,isCertified:h}:x))},O=()=>{N.trim()?(console.log("Adding custom certification with name:",N),y(n=>[...n,{certificationName:N,isCertified:!1}])):console.log("No certification name entered")},R=()=>{b.trim()&&(C(n=>[...n,{specificationName:b,specificationValue:"",specificationValueUnits:""}]),P(""))},B=(n,t)=>{C(d=>d.map((h,g)=>g===n?{...h,specificationValue:t}:h))},_=async n=>{n.preventDefault();const t=[...j];console.log("customCertifications jx:",t);try{const d={...a,certifications:t,specifications:E,varietyIds:I,formIds:S,categoryId:r,productImage:s};console.log("formData jx:",a),console.log("Certifications 2 jx:",d.certifications),console.log("productData jx:",d),await Q(o,d,s),alert("Product Updated successfully!")}catch(d){console.error("Error adding product:",d),alert("Failed to add product.")}};return e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx(q,{title:"Edit Product",userName:"Neha Sharma",showSearchBar:!1}),e.jsxs("form",{className:"container-fluid mt-4",onSubmit:_,children:[e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsxs("div",{className:"product-image-upload",children:[p?e.jsx("img",{src:p,alt:"Uploaded Product",className:"uploaded-image",style:{width:"450px",height:"278px"}}):m?e.jsx("img",{src:m,alt:"Product",className:"uploaded-image",style:{width:"450px",height:"278px"}}):e.jsx("img",{src:m,alt:"Default Product",className:"default-image",style:{width:"450px",height:"278px",objectFit:"cover"}}),e.jsx("input",{type:"file",onChange:F,className:"form-control mt-2"})]}),e.jsxs("div",{className:"card p-4 mb-4 mt-4",children:[e.jsx("h5",{className:"text-center mb-4 heading-with-bar",children:"Product Specifications"}),e.jsxs("div",{className:"card-body",children:[e.jsx("label",{htmlFor:"productDescription",className:"form-group label",children:" Product Description"}),e.jsx("textarea",{name:"productDescription",className:"form-control",rows:"4",placeholder:"Enter product description...",value:a.productDescription,onChange:n=>f({...a,productDescription:n.target.value})}),e.jsx(H,{addedVarieties:I,setAddedVarieties:w}),e.jsx(W,{addedForms:S,setAddedForms:k}),e.jsx(G,{selectedCategory:r,setSelectedCategory:v}),e.jsx("h5",{className:"text-center mb-4 ",children:"Product Certifications"}),e.jsxs("div",{children:[console.log("Parent Component State:",{certifications:[],customCertifications:j,anyOther:N}),e.jsx(Z,{certifications:[],customCertifications:j,handleCheckboxChange:L,handleAddCustomCertification:O,anyOther:N,setAnyOther:$})]})]})]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsxs("div",{className:"card p-4 mb-4",children:[e.jsxs("div",{className:"form-group row mb-3",children:[e.jsx("label",{className:"col-12 col-form-label",children:"HSN Code"}),e.jsx("input",{type:"text",name:"hsnCode",className:"form-control",placeholder:"HSN Code",value:a.hsnCode,onChange:n=>f({...a,hsnCode:n.target.value})})]}),e.jsxs("div",{className:"form-group row mb-3",children:[e.jsx("label",{className:"col-12 col-form-label",children:"Product Name"}),e.jsx("input",{type:"text",name:"productName",className:"form-control",placeholder:"Product Name",value:a.productName,onChange:n=>f({...a,productName:n.target.value})})]})]}),e.jsxs("div",{className:"card p-4 mb-4",children:[e.jsx("h5",{className:"text-center mb-4 heading-with-bar",children:"Specifications"}),e.jsx(ee,{customSpecifications:E,newSpecification:b,setNewSpecification:P,handleAddSpecification:R,handleSpecificationChange:B})]})]})]}),e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx("button",{type:"submit",className:"btn btn-warning border me-1 text-center",style:{width:"200px"},children:"Submit Product"})})]})]})};export{de as default};
