import{e as P,r as m,j as e}from"./index-COlOKGVa.js";import{T as L}from"./Topbar-C2H_McEf.js";import{A as T,a as R}from"./AddForm-0vLe73vP.js";import{A as B}from"./AddCategory-B_5R9Pc7.js";import{d as H}from"./Product2-CFKujFxf.js";import"./AddCategoryService-DgzNEtll.js";const _="http://lyncorganikness.ap-south-1.elasticbeanstalk.com/api/products/add",z="http://lyncorganikness.ap-south-1.elasticbeanstalk.com/api/uploadProductImage";function G(t,r,l=".jpeg"){const p=t.type||"image/jpeg";return new File([t],`${r}${l}`,{type:p})}function M(t){if(!t.productName||typeof t.productName!="string")throw new Error("Invalid product name");if(!t.hsnCode||typeof t.hsnCode!="string"||!/^\d{4}(\d{2})?(\d{2})?$/.test(t.hsnCode))throw new Error("Invalid HSN code. It must be 4, 6, or 8 digits.");if(!t.categoryId||isNaN(t.categoryId))throw new Error("Invalid category ID");if(t.varietyIds&&!Array.isArray(t.varietyIds))throw new Error("Variety IDs must be an array");if(t.formIds&&!Array.isArray(t.formIds))throw new Error("Form IDs must be an array")}const q=async(t,r)=>{var p,i,n,a;console.log("Product data received:",t);const l=localStorage.getItem("authToken");if(!l)throw new Error("No authentication token found.");try{M(t);const s={productName:t.productName,hsnCode:t.hsnCode,categoryId:Number(t.categoryId),varietyIds:((p=t.varietyIds)==null?void 0:p.map(c=>Number(c.varietyId)))||[],formIds:((i=t.formIds)==null?void 0:i.map(c=>Number(c.formId)))||[],productDescription:t.productDescription||"",certifications:((n=t.certifications)==null?void 0:n.map(c=>({certificationName:c.certificationName,isCertified:c.isCertified})))||[],specifications:((a=t.specifications)==null?void 0:a.map(c=>({specificationName:c.specificationName,specificationValue:c.specificationValue,specificationValueUnits:c.specificationValueUnits})))||[]};console.log("Product payload:",s);const h=await P.post(_,s,{headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"}}),y=h.data.productId;if(console.log("Product added successfully with ID:",y),r){console.log("Preparing to upload product image...");const c=G(r,t.productName);console.log("Converted image file:",r);const j=new FormData;j.append("productImage",r);try{const f=await P.post(`${z}/${y}`,j,{headers:{Authorization:`Bearer ${l}`}});console.log("Image uploaded successfully:",f.data)}catch(f){throw console.error("Error during image upload:",f.response?f.response.data:f.message),new Error("Image upload failed.")}}else console.warn("No product image provided.");return h.data}catch(s){throw console.error("Error adding product:",s.response?s.response.data:s.message),s}},J=({certifications:t,customCertifications:r,handleCheckboxChange:l,handleAddCustomCertification:p,anyOther:i,setAnyOther:n})=>e.jsx("div",{className:"col-4",children:e.jsxs("div",{className:"certification border-section",style:{width:"250px"},children:[t.length>0&&t.map(a=>e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:a.certificationName,name:a.certificationName,checked:a.isCertified,onChange:s=>l(s,"certifications",a.certificationName)}),e.jsx("label",{className:"form-check-label",htmlFor:a.certificationName,children:a.certificationName.toUpperCase()})]},a.certificationName)),r.length>0&&r.map((a,s)=>e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:`custom-${s}`,checked:a.isCertified,onChange:h=>l(h,"customCertifications",a.certificationName)}),e.jsx("label",{className:"form-check-label",htmlFor:`custom-${s}`,children:a.certificationName})]},s)),e.jsxs("div",{className:"row mb-4",children:[e.jsx("div",{className:"col-8",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"Any Other",value:i,onChange:a=>n(a.target.value)})}),e.jsx("div",{className:"col-4 d-flex align-items-end",children:e.jsx("button",{type:"button",className:"btn btn-dark",onClick:p,children:"Add"})})]})]})}),K=({customSpecifications:t,newSpecification:r,setNewSpecification:l,handleAddSpecification:p,handleSpecificationChange:i})=>e.jsxs("div",{children:[t.map((n,a)=>e.jsxs("div",{className:"form-group row mb-3",children:[e.jsx("label",{className:"col-4 col-form-label",children:n.specificationName}),e.jsx("div",{className:"col-6",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"Enter value",value:n.specificationValue,onChange:s=>i(a,s.target.value)})})]},a)),e.jsxs("div",{className:"form-group row mb-3",children:[e.jsx("div",{className:"col-4",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"Any Other",value:r,onChange:n=>l(n.target.value)})}),e.jsx("div",{className:"col-2 d-flex align-items-end",children:e.jsx("button",{type:"button",className:"btn btn-dark",onClick:p,children:"Add"})})]})]}),te=()=>{const[t,r]=m.useState(new FormData),[l,p]=m.useState(),[i,n]=m.useState({productDescription:"",productVariety:"",productForm:"",hsnCode:"",productName:"",certifications:[]}),[a,s]=m.useState([]),[h,y]=m.useState([]),[c,j]=m.useState(""),[f,k]=m.useState([{certificationName:"NPOP",isCertified:!1},{certificationName:"NOP",isCertified:!1},{certificationName:"EU",isCertified:!1},{certificationName:"GSDC",isCertified:!1}]),[v,w]=m.useState([]),[C,I]=m.useState(""),[S,A]=m.useState([]),[b,E]=m.useState(""),F=o=>{const d=o.target.files[0];d&&(r(d),p(URL.createObjectURL(d)))},V=(o,d,u)=>{const{checked:g}=o.target;console.log("Checkbox changed:"),console.log("Certification Name:",u),console.log("Checked:",g),console.log("Type:",d),d==="certifications"?k(x=>x.map(N=>N.certificationName===u?{...N,isCertified:g}:N)):d==="customCertifications"&&w(x=>x.map(N=>N.certificationName===u?{...N,isCertified:g}:N))},D=()=>{b.trim()?(console.log("Adding custom certification with name:",b),w(o=>[...o,{certificationName:b,isCertified:!1}])):console.log("No certification name entered")},U=()=>{C.trim()&&(A(o=>[...o,{specificationName:C,specificationValue:"",specificationValueUnits:""}]),I(""))},$=(o,d)=>{A(u=>u.map((g,x)=>x===o?{...g,specificationValue:d}:g))},O=async o=>{o.preventDefault();const d=[...f,...v];try{const u={...i,certifications:d,specifications:S,varietyIds:a,formIds:h,categoryId:c,productImage:t};await q(u,t),alert("Product added successfully!")}catch(u){console.error("Error adding product:",u),alert("Failed to add product.")}};return e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx(L,{title:"Add Product",userName:"Neha Sharma",showSearchBar:!1}),e.jsxs("form",{className:"container-fluid mt-4",onSubmit:O,children:[e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsxs("div",{className:"product-image-upload",children:[t?e.jsx("img",{src:l,alt:"Product",className:"uploaded-image",style:{width:"400px",height:"278px"}}):e.jsx("img",{src:H,alt:"Default Product",className:"default-image",style:{width:"450px",height:"278px",objectFit:"cover"}}),e.jsx("input",{type:"file",onChange:F,className:"form-control mt-2"})]}),e.jsxs("div",{className:"card p-4 mb-4 mt-4",children:[e.jsx("h5",{className:"text-center mb-4 heading-with-bar",children:"Product Specifications"}),e.jsxs("div",{className:"card-body",children:[e.jsx("textarea",{name:"productDescription",className:"form-control",rows:"4",placeholder:"Enter product description...",value:i.productDescription,onChange:o=>n({...i,productDescription:o.target.value})}),e.jsx(T,{addedVarieties:a,setAddedVarieties:s}),e.jsx(R,{addedForms:h,setAddedForms:y}),e.jsx(B,{selectedCategory:c,setSelectedCategory:j}),e.jsx("h5",{className:"text-center mb-4 ",children:"Product Certifications"}),e.jsx(J,{certifications:f,customCertifications:v,handleCheckboxChange:V,handleAddCustomCertification:D,anyOther:b,setAnyOther:E})]})]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsxs("div",{className:"card p-4 mb-4",children:[e.jsxs("div",{className:"form-group row mb-3",children:[e.jsx("label",{className:"col-12 col-form-label",children:"HSN Code"}),e.jsx("input",{type:"text",name:"hsnCode",className:"form-control",placeholder:"HSN Code",value:i.hsnCode,onChange:o=>n({...i,hsnCode:o.target.value})})]}),e.jsxs("div",{className:"form-group row mb-3",children:[e.jsx("label",{className:"col-12 col-form-label",children:"Product Name"}),e.jsx("input",{type:"text",name:"productName",className:"form-control",placeholder:"Product Name",value:i.productName,onChange:o=>n({...i,productName:o.target.value})})]})]}),e.jsxs("div",{className:"card p-4 mb-4",children:[e.jsx("h5",{className:"text-center mb-4 heading-with-bar",children:"Additional Specifications"}),e.jsx(K,{customSpecifications:S,newSpecification:C,setNewSpecification:I,handleAddSpecification:U,handleSpecificationChange:$})]})]})]}),e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx("button",{type:"submit",className:"btn btn-warning border me-1 text-center",style:{width:"200px"},children:"Add Product"})})]})]})};export{te as default};
