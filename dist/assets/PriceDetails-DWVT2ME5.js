import{e as h,b as T,r as o,j as e}from"./index-COlOKGVa.js";import{T as B,p as _}from"./Topbar-C2H_McEf.js";import{p as q}from"./Product-BQCOhBn7.js";import{I as L}from"./InquiriesService-D6_IMM9T.js";import{g as V}from"./ProductService-BTIW0j6s.js";import{g as z}from"./AddCategoryService-DgzNEtll.js";import{a as U,g as Q}from"./VarietyFormService-BveRte0p.js";import{B as G}from"./Back-DUcgJcu8.js";const H="http://lyncorganikness.ap-south-1.elasticbeanstalk.com",J=async i=>{var c,a;const t=localStorage.getItem("authToken");if(!t)throw new Error("Authentication token not found.");try{return(await h.post(`${H}/auth/admin/adminRejectedSeller/${i}`,{},{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}})).data}catch(l){throw console.error("Error rejecting seller:",l),new Error(((a=(c=l.response)==null?void 0:c.data)==null?void 0:a.message)||"Failed to reject seller. Try again.")}},K="http://lyncorganikness.ap-south-1.elasticbeanstalk.com",M=async i=>{var c,a;const t=localStorage.getItem("authToken");if(!t)throw new Error("Authentication token not found.");try{return(await h.post(`${K}/auth/admin/adminSelectsSeller/${i}`,{},{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}})).data}catch(l){throw console.error("Error approving seller:",l),new Error(((a=(c=l.response)==null?void 0:c.data)==null?void 0:a.message)||"Already Approved Seller")}},O="http://lyncorganikness.ap-south-1.elasticbeanstalk.com",W=async(i,t)=>{var a,l;const c=localStorage.getItem("authToken");if(!c)throw new Error("Authentication token not found.");try{return(await h.post(`${O}/auth/admin/sendFinalPrice/${i}`,{amount:t},{headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"}})).data}catch(m){throw console.error("Error submitting final price:",m),new Error(((l=(a=m.response)==null?void 0:a.data)==null?void 0:l.message)||"Failed to submit final price. Try again.")}},le=()=>{const{queryId:i}=T(),[t,c]=o.useState(null),[a,l]=o.useState([]),[m,j]=o.useState([]),[f,y]=o.useState([]),[g,S]=o.useState([]),[u,b]=o.useState(null),[d,p]=o.useState(""),[x,v]=o.useState({});o.useEffect(()=>{(async()=>{try{const r=await L.getInquiryById(i);l(r.sellerNegotiations||[]);const N=(await V()).find(D=>D.productId===r.productId);N?c(N):console.warn(`Product with ID ${r.productId} not found.`);const C=await z(),R=await U(),F=await Q();j(C),y(R),S(F)}catch(r){console.error("Error fetching details:",r.message),alert("Failed to fetch details. Please try again later.")}})()},[i]);const w=async s=>{try{const r=await J(s);alert(`Seller with SN ID ${s} rejected successfully!`),console.log("API Response:",r)}catch(r){console.error("Error rejecting seller:",r.message),alert(r.message||"Failed to reject seller. Please try again.")}},P=async s=>{try{const r=await M(s);alert(`Seller with SN ID ${s} approved successfully!`),console.log("API Response:",r)}catch(r){console.error("Error approving seller:",r.message),alert(r.message||"Failed to approve seller. Please try again.")}},I=s=>{const r=m.find(n=>n.id===s);return r?r.categoryId:"N/A"},A=s=>{const r=f.find(n=>n.id===s);return r?r.formName:"N/A"},k=s=>{const r=g.find(n=>n.id===s);return r?r.varietyName:"N/A"},$=s=>{b(r=>r===s?null:s),p("")},E=async s=>{if(!d||isNaN(d)||Number(d)<=0){alert("Please enter a valid proposal price.");return}try{const r=await W(s,d);alert(`Successfully submitted final price: ${d} for SN ID: ${s}`),console.log("API Response:",r)}catch(r){console.error("Error submitting proposal price:",r.message),alert(r.message||"Failed to submit the proposal price. Please try again.")}v(r=>({...r,[s]:d})),p("")};return e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx(B,{title:"Query",userName:"Neha Sharma",showSearchBar:!1}),e.jsxs("div",{className:"container mt-4",children:[e.jsx(G,{}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-5",children:[e.jsx("h6",{children:"Product Details"}),t?e.jsx("div",{className:"card p-3 shadow-sm mb-4",style:{borderRadius:"8px"},children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-3",children:e.jsx("img",{src:q,alt:"Product",style:{width:"82px",height:"80px",borderRadius:"8px",objectFit:"cover"}})}),e.jsxs("div",{className:"col-9 ps-3",children:[e.jsx("p",{style:{margin:"0",fontSize:"18px"},children:t.productName}),e.jsxs("p",{className:"product-description",children:["Category: ",I(t.categoryId)]}),e.jsxs("p",{className:"product-description",children:["Variety: ",k(t.varietyId)]}),e.jsxs("p",{className:"product-description",children:["Form: ",A(t.formId)]}),e.jsxs("p",{className:"product-description",children:["Price Range: ",t.priceRange||"N/A"]}),e.jsxs("p",{className:"product-description",children:["Certification: ",t.certification||"N/A"]}),e.jsxs("p",{className:"product-description",children:["Location: ",t.location||"N/A"]})]})]})}):e.jsx("p",{className:"text-muted",children:"Loading product details..."})]}),e.jsx("div",{className:"col-md-7",children:e.jsxs("div",{className:"card p-3 shadow-sm mb-4",style:{borderRadius:"8px"},children:[e.jsx("h4",{children:"Sellers"}),a&&a.length>0?a.map((s,r)=>e.jsxs("div",{className:"card p-3 shadow-sm mb-4 seller-card position-relative",style:{borderRadius:"8px"},children:[e.jsxs("div",{className:"d-flex",children:[e.jsx("div",{className:"col-2",children:e.jsx("img",{src:_,alt:"Seller",className:"seller-image",style:{width:"50px",height:"50px",borderRadius:"50%"}})}),e.jsx("div",{className:"col-10",style:{marginTop:"10px"},children:e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("div",{children:[e.jsx("h6",{children:s.sellerUId}),e.jsx("p",{children:s.sellerName||"Seller Name"}),e.jsx("p",{children:s.email||"Seller Email"}),e.jsx("p",{children:s.phoneNumber||"Seller Phone No"}),e.jsx("p",{className:"seller-address",children:`${s.adminCity||"N/A"}, ${s.adminState||"N/A"}, ${s.adminCountry||"N/A"} - ${s.adminPinCode||"N/A"}`}),e.jsxs("p",{children:["snId: ",s.snId||"N/A"]}),e.jsxs("p",{children:["status: ",s.status||"N/A"]}),e.jsxs("div",{className:"alert w-100 ",children:["Seller Negotiated Price: ",s.sellerNegotiatePrice||"N/A"]}),x[s.snId]&&e.jsx("div",{className:"mt-2",children:e.jsxs("span",{className:"badge bg-warning mb-4  w-100",children:["Price Submitted: ",x[s.snId]]})}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("button",{className:"btn btn-success btn-sm",onClick:()=>P(s.snId),children:"Approve"}),e.jsx("button",{className:"btn btn-danger btn-sm",onClick:()=>w(s.snId),children:"Reject"})]})]}),e.jsxs("div",{className:"form-check position-absolute",style:{top:"10px",right:"10px"},children:[e.jsxs("div",{className:"form-check mt-2",children:[e.jsx("input",{type:"checkbox",className:"form-check-input",id:`selectSeller${s.snId}`,checked:u===s.snId,onChange:()=>$(s.snId)}),e.jsx("label",{className:"form-check-label ms-2",htmlFor:`selectSeller${s.snId}`,children:"Select Seller"})]}),e.jsxs("div",{className:"text-end",style:{marginTop:"10px"},children:[e.jsxs("p",{children:["Initial Price: ",s.adminInitialPrice]}),e.jsxs("p",{className:"seller-info",children:["Quantity: ",s.availableAmount||0]})]})]})]})})]}),u===s.snId&&e.jsx("div",{className:"mt-3 p-3 border rounded shadow-sm",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("input",{type:"number",className:"form-control me-2",placeholder:"Proposal Final Price",value:d,onChange:n=>p(n.target.value)}),e.jsx("button",{className:"btn btn-dark",onClick:()=>E(s.snId),children:"Submit"})]})})]},r)):e.jsx("p",{className:"text-muted",children:"No negotiations available for this query."})]})})]})]})]})};export{le as default};
